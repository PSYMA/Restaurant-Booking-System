<div class="bg-white p-0">
    <%= render "shared/navbar" %>    
    <div class="container py-5">  
        <div class="text-center">
            <h5 class="section-title ff-secondary text-center text-primary fw-normal">Reservation Section</h5>
            <h1 class=" ">Restaurant Bookings</h1>
        </div>  
        
        <% if Current.user.role == Roles::ADMIN %> 
            <div class="panel panel-default panel-table" >   
                <%= turbo_frame_tag "admin_bookings" do %>
                    <div class="pull-right mb-2">
                        <%= search_form_for @q, url: bookings_path do |form|%> 
                            <div class="text-center mt-1">
                                <%= form.search_field :first_name_cont %>
                                <%= form.submit %>
                            </div>
                        <% end %>
                    </div>

                    <div class="panel-table">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr class="text-center"> 
                                    <th>NAME</th>
                                    <th>DATE</th> 
                                    <th>STATUS</th> 
                                    <th>PRODUCTS</th>
                                    <th>TOTAL PRICE</th>
                                    <th><em class="fa fa-cog"></em></th>
                                </tr> 
                            </thead>
                            <tbody> 
                                <% @reservations.each do |reservation|%>  
                                    <tr class="text-center align-middle fw-bold"> 
                                        <td>
                                            <h6>
                                                <% user = User.find(reservation.user_id) %>
                                                <%= user.first_name %> <%= user.last_name %>
                                            </h6>
                                            
                                        </td>
                                        <td> <h6><%= reservation.date %></h6> </td> 
                                        <td>
                                            <% if reservation.status == Status::PENDING %>
                                                <h6 class="text-warning">PENDING</h6>
                                            <% elsif reservation.status == Status::CONFIRMED %>
                                                <h6 class="text-success">CONFIRMED</h6>
                                            <% else %>
                                                <h6 class="text-danger">DECLINE</h6>
                                            <% end %>
                                        </td> 
                                        <td>
                                            <button class="btn btn-secondary fw-bolder" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                                                ordered products
                                            </button> 
                                            <%= render "modal", orders: reservation.order.order_products %> 
                                        </td>
                                        <td><h6><%= reservation.order.total_amount %> $</h6></td>
                                        <td class="text-center"> 
                                            <div class="btn-group">   
                                                <%= form_with url: bookings_path, data: { turbo: true }, method: :patch do |form|%>
                                                    <%= form.hidden_field :reservation_id, value: reservation.id %>
                                                    <button class="btn btn-success" style="margin-right: .5em">
                                                        <i class="fa fa-check"></i>
                                                    </button>
                                                <% end %> 
                                                <%= form_with url: bookings_path, data: { turbo: true }, method: :put do |form|%>
                                                    <%= form.hidden_field :reservation_id, value: reservation.id %>
                                                    <button class="btn btn-danger">
                                                        <i class="fa fa-times"></i>
                                                    </button>
                                                <% end %>  
                                            </div>
                                        </td>
                                    </tr>
                                <% end %> 
                            </tbody>
                        </table> 
                    </div> 

                    <div class="digg_pagination pull-right"> 
                        <div class="page_info">
                            <%= page_entries_info @reservations %>
                        </div>
                        <div class="pagination visible-xs pull-right">
                            <%= will_paginate @reservations %> 
                        </div> 
                    </div>    
                    <%= javascript_include_tag "js/bookings.js", "data-turbo-track": "reload", defer: true %> 
                <% end %>
            </div> 
        <% else %>  
            <% Current.user.reservations.reverse.each do |reservation| %>
                <div class="panel panel-default panel-table mb-5" >
                    <%= turbo_frame_tag "customer_bookings" do %>    
                        <% if reservation.status == Status::PENDING %>
                            <h5 class="text-warning">Date: <%= reservation.date%></h5> 
                            <h5 class="text-warning">Status: PENDING</h5>
                        <% elsif reservation.status == Status::CONFIRMED %>
                            <h5 class="text-success">Date: <%= reservation.date%></h5> 
                            <h5 class="text-success">Status: CONFIRMED</h5>
                        <% else %>
                            <h5 class="text-danger">Date: <%= reservation.date%></h5> 
                            <h5 class="text-danger">Status: DECLINE</h5>
                        <% end %> 
                    
                        <div class="panel-table">
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <tr class="text-center"> 
                                        <th><i class="fa fa-picture-o" aria-hidden="true"></i></th>
                                        <th>NAME</th> 
                                        <th>PRICE</th> 
                                    </tr> 
                                </thead>
                                <tbody>   
                                    <% reservation.order.order_products.paginate(:page => params[:page], per_page: 8).each do |order| %>
                                        <% product = Product.find(order.product_id) %>
                                        <tr class="text-center align-middle fw-bold">
                                            <td><%= image_tag(product.image(), :style => "width: 3.5em") %></td>
                                            <td><%= product.name %></td> 
                                            <td><%= product.price %> $</td>
                                        </tr> 
                                    <% end %>
                                </tbody>
                            </table> 
                        </div>  

                        <div class="digg_pagination pull-right float-right"> 
                            <div class="page_info">
                                <%= page_entries_info reservation.order.order_products.paginate(:page => params[:page], per_page: 8) %>
                            </div>
                            <div class="pagination visible-xs pull-right">
                                <%= will_paginate reservation.order.order_products.paginate(:page => params[:page], per_page: 8) %> 
                            </div> 
                        </div>    
                    <% end %>
                </div> 
            <% end %> 
        <% end %>  
    </div>  
</div> 


